data:
  data_root: 'data'
  tasks:
    - 'BraTS_Task1'
    - 'BraTS_Task2'
    - 'BraTS_Task3'
    # - 'MyBraTS'  # 添加你的测试数据

  # Crop策略（关键配置）
  crop_size: [224, 224, 128]  # 推荐大crop
  crop_strategy: 'hybrid'     # hybrid | smart_random | random

  # 数据处理
  normalize: true
  augment_type: 'domain'      # none | domain


# ============ 模型配置 ============
model:
  name: 'ResUNet'
  in_channels: 4              # T1, T1ce, T2, FLAIR
  out_channels: 3             # WT, TC, ET
  base_channels: 24           # 16(轻量) | 24(中) | 32(标准) | 64(大型)


# ============ MAML配置 ============
maml:
  algorithm: 'first_order'    # first_order | second_order
  inner_lr: 0.01              # 内循环学习率
  outer_lr: 0.001             # 外循环学习率
  inner_steps: 3              # 内循环步数（3步即可，不要太多）
  l2_reg: 0.001               # L2正则化（防止过拟合）


# ============ 元学习配置 ============
meta_learning:
  k_shot: 2                   # Support样本数
  k_query: 2                  # Query样本数
  meta_batch_size: 1          # 元批次大小（3D通常为1）


# ============ 训练配置 ============
training:
  num_epochs: 100
  iterations_per_epoch: 50    # 每轮迭代次数

  # 优化器
  optimizer: 'adam'
  weight_decay: 0.00001

  # 学习率调度
  lr_scheduler:
    type: 'reduce_on_plateau'
    mode: 'max'               # 监控dice（越大越好）
    factor: 0.5
    patience: 15

  # 早停
  early_stopping:
    enabled: true
    patience: 30
    min_delta: 0.0001

  # 显存优化
  use_amp: false              # 混合精度训练（可节省50%显存）
  gradient_accumulation: 1    # 梯度累积
  max_grad_norm: 1.0          # 梯度裁剪


# ============ 验证配置 ============
validation:
  enabled: true
  interval: 2                 # 每5个epoch验证一次
  num_val_tasks: 10           # 验证任务数


# ============ 保存配置 ============
checkpoint:
  save_dir: 'checkpoints_12251058'
  save_interval: 10           # 每10个epoch保存
  save_best: true
  keep_last_n: 3              # 保留最近3个checkpoint


# ============ 日志配置 ============
logging:
  log_dir: 'logs_12251058'
  log_interval: 2             # 每5次迭代打印
  tensorboard: true
  save_training_curves: true


# ============ 测试配置 ============
testing:
  checkpoint: 'checkpoints_12251058/best_model.pth'
  test_tasks:
    - 'gulou_philips'               # 你的测试数据
  verbose: false
  # 测试时推理策略
  inference:
    mode: 'sliding_window'    # sliding_window | center_crop
    overlap: 0.5              # 滑动窗口重叠率

  # 输出
  save_predictions: true
  output_dir: 'results_0110_gulou_philips_depart'
  visualization: true
  enable_adaptation: true
  adaptation_k_shot: 10
  adaptation_inner_steps: 30
  threshold: 0.5
  num_visualize: 20
# ============ 硬件配置 ============
hardware:
  device: 'cuda'              # cuda | cpu
  num_workers: 4              # 数据加载线程数
  pin_memory: true
