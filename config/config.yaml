# BraTS MAML训练配置

# ============ 数据配置 ============
data:
  data_root: 'data'
  tasks:
    - 'BraTS_Task1'
    # - 'MyBraTS'  # 添加你的测试数据
  crop_size: [224, 224, 128]  # 推荐大crop
  crop_strategy: 'hybrid'     # hybrid | smart_random | random
  normalize: true
  augment_type: 'domain'      # none | domain

# ============ 增强配置 ============
augmentation:
  domain:
    brightness_range: [0.85, 1.15]
    contrast_range: [0.9, 1.1]
    noise_std_range: [0, 0.03]

# ============ 模型配置 ============
model:
  name: 'ResUNet'
  in_channels: 4              # T1, T1ce, T2, FLAIR
  out_channels: 3             # WT, TC, ET
  base_channels: 24           # 16(轻量) | 24(中) | 32(标准) | 64(大型)

# ============ MAML配置 ============
maml:
  algorithm: 'first_order'    # first_order | second_order
  inner_lr: 0.01              # 内循环学习率
  outer_lr: 0.001             # 外循环学习率
  inner_steps: 3              # 内循环步数
  l2_reg: 0.001               # L2正则化

# ============ 元学习配置 ============
meta_learning:
  k_shot: 2                   # Support样本数
  k_query: 2                  # Query样本数
  meta_batch_size: 1          # 元批次大小

# ============ 训练配置 ============
training:
  num_epochs: 100
  iterations_per_epoch: 50
  
  optimizer: 'adam'
  weight_decay: 0.00001
  
  lr_scheduler:
    type: 'reduce_on_plateau'
    mode: 'max'
    factor: 0.5
    patience: 15
  
  early_stopping:
    enabled: true
    patience: 30
    min_delta: 0.0001
  
  use_amp: false
  gradient_accumulation: 1
  max_grad_norm: 1.0

# ============ 验证配置 ============
validation:
  enabled: true
  interval: 2
  num_val_tasks: 10
  val_tasks: null  # 指定验证任务

# ============ 检查点配置 ============
checkpoint:
  save_dir: 'checkpoints_12251058'
  save_interval: 10
  save_best: true
  keep_last_n: 3

# ============ 日志配置 ============
logging:
  log_dir: 'logs_12251058'
  log_interval: 2
  tensorboard: false
  save_training_curves: true

# ============ 测试配置 ============
testing:
  checkpoint: 'checkpoints_12251058/best_model.pth'
  test_tasks:
    - 'gulou_philips'
  verbose: false
  save_predictions: true
  output_dir: 'results_0110_gulou_philips_depart'
  visualization: true
  enable_adaptation: true
  adaptation_k_shot: 10
  adaptation_inner_steps: 30
  threshold: 0.5
  num_visualize: 20

# ============ 硬件配置 ============
hardware:
  device: 'cuda'
  num_workers: 4
  pin_memory: true